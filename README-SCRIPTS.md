# 🚀 LawsOS 自動化腳本使用指南

## 📋 腳本概覽

| 腳本 | 用途 | 使用場景 | 執行時間 | 推薦度 |
|------|------|----------|----------|--------|
| `.\dev.ps1` | 開發環境啟動 | 日常開發 | 10-30秒 | ⭐⭐⭐⭐⭐ |
| `.\build-test.ps1` | 構建測試 | 部署前測試 | 30-60秒 | ⭐⭐⭐⭐⭐ |
| `.\deploy-safe.ps1` | 🛡️ 安全部署 | **所有部署場景** | 1-2分鐘 | ⭐⭐⭐⭐⭐ |
| `.\quick-deploy.ps1` | 快速部署 | 小修改快速上線 | 1-2分鐘 | ⭐⭐⭐⭐ |
| `.\deploy.ps1` | 完整部署 | 備用部署選項 | 1-3分鐘 | ⭐⭐⭐ |
| `.\validate-deploy.ps1` | 部署環境驗證 | 故障排除 | 30-60秒 | ⭐⭐⭐⭐ |

## 🌐 部署架構說明

### 分支結構
- **main 分支**: 開發分支，包含源代碼
- **gh-pages 分支**: 部署分支，包含構建後的靜態文件

### 部署流程
1. **本地開發** → 修改 `src/` 目錄下的源文件
2. **自動構建** → Vite 將 React 代碼編譯為靜態文件
3. **自動部署** → 腳本將構建文件推送到 gh-pages 分支
4. **GitHub Pages** → 自動從 gh-pages 分支發布網站

## 🛠️ 日常開發流程

### 1. 開始開發
```powershell
# 啟動開發環境（自動安裝依賴、切換分支、拉取代碼）
.\dev.ps1

# 如果需要重新安裝依賴
.\dev.ps1 -Install

# 如果需要清理並重新安裝
.\dev.ps1 -Clean
```

### 2. 開發過程
- **編輯文件**: 修改 `src/` 目錄下的文件
- **熱重載**: 瀏覽器自動刷新顯示更改
- **開發服務器**: `http://localhost:5173`
- **主要文件**:
  - `src/pages/` - 各頁面組件
  - `src/components/Sidebar.jsx` - 側邊欄組件
  - `src/styles.css` - 樣式文件
  - `src/App.jsx` - 主應用和路由配置

### 3. 本地測試

#### 🔧 開發模式測試
```powershell
# 啟動開發服務器
.\dev.ps1

# 在瀏覽器中測試以下功能：
# ✅ 所有頁面是否正常顯示
# ✅ 側邊欄切換功能
# ✅ 響應式設計（調整瀏覽器窗口大小）
# ✅ 移動端模式（F12 → 設備模擬）
# ✅ 路由切換是否無縫
# ✅ 動畫效果是否正常
```

#### 🚀 生產模式測試
```powershell
# 構建並預覽生產版本
.\build-test.ps1

# 這個腳本會：
# 1. 清理舊的構建文件
# 2. 執行生產構建 (npm run build)
# 3. 檢查構建文件完整性
# 4. 啟動預覽服務器 (http://localhost:4173)
# 5. 顯示構建統計信息
```

#### 📱 測試檢查清單
- [ ] **首頁**: KPI 數字動畫正常
- [ ] **導航**: 側邊欄切換無縫
- [ ] **路由**: 所有頁面可正常訪問
- [ ] **響應式**: 桌面和移動端顯示正常
- [ ] **性能**: 頁面載入速度快
- [ ] **樣式**: CSS 樣式正確應用

### 4. 測試構建
```powershell
# 測試構建是否正常（部署前必做）
.\build-test.ps1
```

### 5. 部署上線

#### 🛡️ 安全部署（強烈推薦）
```powershell
# 使用新的安全部署腳本
.\deploy-safe.ps1

# 指定提交信息
.\deploy-safe.ps1 -Message "修復首頁顯示問題"

# 強制部署
.\deploy-safe.ps1 -Force
```

**安全部署特點**:
- ✅ **防止 node_modules 污染** - 絕不會將依賴文件部署到網站
- ✅ **文件數量檢查** - 自動檢測異常文件數量並停止部署
- ✅ **系統臨時目錄** - 避免分支切換時的文件衝突
- ✅ **完整錯誤處理** - 出錯時自動回滾和清理
- ✅ **部署統計** - 顯示詳細的部署文件信息

**安全部署流程**:
1. 🔍 檢查並安裝依賴
2. 🔨 執行生產構建並驗證
3. 📁 在系統臨時目錄創建部署文件
4. 🧹 完全清理 gh-pages 分支
5. 📋 檢查文件數量（超過20個自動停止）
6. 📤 複製文件並推送到 GitHub
7. 🌐 等待 GitHub Pages 更新（2-5分鐘）

**為什麼推薦安全部署**:
- 🛡️ **零污染風險** - 經過實戰測試，絕不會出現 node_modules 污染
- 📊 **智能檢測** - 自動檢測異常情況並停止部署
- 🔄 **完全隔離** - 使用系統臨時目錄，避免所有分支衝突問題
- 📈 **詳細統計** - 清楚顯示部署了哪些文件和大小

#### 🚀 快速部署（日常使用）
```powershell
# 一鍵部署，使用默認提交信息
.\quick-deploy.ps1

# 或指定提交信息
.\quick-deploy.ps1 -Message "修復首頁顯示問題"
```

**快速部署流程**:
1. ✅ 自動提交代碼到 main 分支
2. ✅ 自動構建 React 應用
3. ✅ 自動部署到 gh-pages 分支
4. ✅ 自動推送到 GitHub
5. ✅ GitHub Pages 自動更新網站

#### 🔧 完整部署（備用選項）
```powershell
# 交互式部署，會提示輸入提交信息
.\deploy.ps1

# 直接指定提交信息
.\deploy.ps1 -Message "添加新的統計頁面"

# 跳過構建（如果已經構建過）
.\deploy.ps1 -SkipBuild

# 強制部署（跳過確認）
.\deploy.ps1 -Force
```

**完整部署流程**:
1. 🔍 檢查 Git 狀態和未提交更改
2. 📝 交互式輸入提交信息
3. 🔄 自動切換分支和拉取最新代碼
4. 🔨 執行生產構建
5. 🧹 清理 gh-pages 分支舊文件
6. 📁 複製新的構建文件
7. 📤 提交並推送到 GitHub
8. 🌐 等待 GitHub Pages 更新（2-5分鐘）

## 📝 常用命令示例

### 日常小修改
```powershell
# 1. 啟動開發
.\dev.ps1

# 2. 修改代碼...

# 3. 快速部署
.\quick-deploy.ps1 -Message "修復按鈕樣式"
```

### 添加新功能
```powershell
# 1. 啟動開發
.\dev.ps1

# 2. 開發新功能...

# 3. 測試構建
.\build-test.ps1

# 4. 正式部署
.\deploy.ps1 -Message "添加用戶管理功能"
```

### 緊急修復
```powershell
# 1. 快速修復代碼

# 2. 立即部署
.\quick-deploy.ps1 -Message "緊急修復：修復登錄問題"
```

## 🔧 腳本功能詳解

### `dev.ps1` - 開發環境
- ✅ 自動檢查並安裝依賴
- ✅ 切換到 main 分支
- ✅ 拉取最新代碼
- ✅ 啟動開發服務器
- ✅ 支援清理重裝模式

### `build-test.ps1` - 構建測試
- ✅ 清理舊構建文件
- ✅ 執行構建
- ✅ 檢查構建結果
- ✅ 啟動預覽服務器
- ✅ 構建狀態報告

### `quick-deploy.ps1` - 快速部署
- ✅ 自動生成提交信息
- ✅ 強制執行模式
- ✅ 適合日常小修改
- ✅ 一鍵完成所有步驟

### `deploy.ps1` - 完整部署
- ✅ Git 狀態檢查
- ✅ 交互式提交信息
- ✅ 自動分支管理
- ✅ 構建和部署
- ✅ 錯誤處理和回滾
- ✅ 彩色輸出和進度提示

## ⚠️ 注意事項

### 執行權限
如果遇到執行權限問題，請運行：
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### 常見問題

1. **腳本無法執行**
   ```powershell
   # 設置執行權限
   Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
   ```
   - 檢查是否在項目根目錄
   - 確認 PowerShell 執行權限

2. **構建失敗**
   ```powershell
   # 清理並重新安裝依賴
   .\dev.ps1 -Clean
   ```
   - 檢查代碼語法錯誤
   - 確認 Node.js 版本兼容性
   - 檢查網絡連接

3. **部署失敗**
   ```powershell
   # 檢查 Git 狀態
   git status
   git log --oneline -5
   ```
   - 檢查網絡連接
   - 確認 Git 配置正確
   - 檢查 GitHub 權限

4. **網站沒有更新**
   - ⏰ 等待 2-5 分鐘（GitHub Pages 需要時間）
   - 🧹 清除瀏覽器緩存（Ctrl+F5）
   - 🔍 檢查 gh-pages 分支是否正確推送
   - 📱 嘗試無痕模式瀏覽

### 🚨 緊急修復流程

如果網站出現問題，快速修復步驟：

```powershell
# 1. 快速修復代碼
# 2. 立即部署
.\quick-deploy.ps1 -Message "緊急修復: 描述問題"

# 3. 如果還有問題，回滾到上一個版本
git log --oneline -5  # 查看最近的提交
git reset --hard <上一個正常的commit-hash>
.\quick-deploy.ps1 -Message "回滾到穩定版本"
```

## 🎯 最佳實踐

### 📋 開發流程
1. **開發前先拉取**：使用 `.\dev.ps1` 自動處理
2. **部署前先測試**：使用 `.\build-test.ps1` 確認構建
3. **優先使用安全部署**：`.\deploy-safe.ps1` （強烈推薦）
4. **小修改用快速部署**：`.\quick-deploy.ps1`
5. **遇到問題先驗證**：`.\validate-deploy.ps1`
6. **定期清理依賴**：`.\dev.ps1 -Clean`

### 🔒 安全實踐
- ✅ 定期備份重要更改
- ✅ 重要功能前創建分支測試
- ✅ 使用有意義的提交信息
- ✅ 部署前在本地充分測試

### ⚡ 效率提升
- �️ 優先使用 `.\deploy-safe.ps1` 避免部署問題
- �🚀 使用 `.\quick-deploy.ps1` 進行日常小修改
- 🔧 使用 `.\build-test.ps1` 在部署前驗證
- 📝 準備常用的提交信息模板
- 🎯 一次只專注一個功能的開發
- 🔄 定期使用 `.\dev.ps1 -Clean` 清理環境

### 📊 性能監控
- 📈 定期檢查網站載入速度
- 📱 測試移動端性能
- 🔍 監控構建文件大小
- 🌐 確認所有功能在生產環境正常

## 🚨 部署問題專門說明

### 常見部署問題及解決方案

#### 1. node_modules 被意外部署
**症狀**: GitHub Pages 網站載入緩慢，gh-pages 分支包含上千個文件
**解決**: 使用 `.\deploy-safe.ps1` 重新部署

#### 2. vite 命令找不到
**症狀**: 部署時出現 "vite 不是內部或外部命令"
**解決**: 腳本會自動檢查並重新安裝依賴

#### 3. 部署文件數量異常
**症狀**: 部署包含過多文件
**解決**: `deploy-safe.ps1` 會自動檢測並停止異常部署

#### 4. 分支切換問題
**症狀**: 切換分支時文件丟失或衝突
**解決**: 使用系統臨時目錄完全避免此問題

### 🛠️ 故障排除工具

```powershell
# 驗證部署環境
.\validate-deploy.ps1

# 強制安全部署（修復大部分問題）
.\deploy-safe.ps1 -Force

# 查看詳細的修復說明
# 請參考 DEPLOY-FIXES.md 文件
```

## 🌐 部署結果

- **網站地址**：https://boharry.github.io/lawsOSoverview/
- **更新時間**：2-5 分鐘
- **分支管理**：main（開發）+ gh-pages（部署）
- **推薦部署方式**：`.\deploy-safe.ps1` 🛡️

---

⭐ **重要提示**:
- 🛡️ 強烈建議使用 `deploy-safe.ps1` 進行所有部署
- 📖 遇到部署問題請查看 `DEPLOY-FIXES.md` 獲取詳細說明
- 🔧 如果遇到任何問題，請先檢查 PowerShell 執行權限
